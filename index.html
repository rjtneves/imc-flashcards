<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>FlashDeck</title>
  <style>
    :root { font-family: Arial, sans-serif; --primary: #5d2028; --bg: #f5f7fa; }
    body { margin: 0; padding: 0; background: var(--bg); }
    header { background: var(--primary); color: #fff; padding: 1rem 2rem; display: flex; align-items: center; justify-content: space-between; }
    .title { font-size: 1.5rem; }
    .actions { display: flex; gap: 0.5rem; }
    .actions button, .profile-btn { background: transparent; color: #fff; border: 1px solid #fff; padding: .5rem 1rem; border-radius: 4px; cursor: pointer; }
    .dropdown { position: relative; }
    .dropdown-menu { display: none; position: absolute; right: 0; top: 100%; background: #fff; color: #000; border: 1px solid #ccc; border-radius: 4px; }
    .dropdown-menu button { display: block; width: 100%; padding: .5rem 1rem; background: #fff; color: #000; border: none; text-align: left; cursor: pointer; }
    .dropdown-menu button:hover { background: #f0f0f0; }
    section { padding: 1rem 2rem; }
    .card-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; }
    .card-button { background: #fff; border: 2px solid var(--primary); border-radius: 8px; padding: 1rem; cursor: pointer; width: 100%; height: 100px; overflow: hidden; text-align: center; color: black; display: flex; align-items: center; justify-content: center; }
    .card-button:hover { background: var(--primary); color: #fff; }
    #cardBox { background: #fff; border: 2px solid var(--primary); border-radius: 8px; padding: 2rem; height: 200px; display: flex; align-items: center; justify-content: center; }
    #cardText { font-size: 1.4rem; line-height: 1.5; }
    .nav-btns { display: flex; gap: 0.5rem; margin-top: 1rem; }
    button, input[type=file], input[type=text] { background: var(--primary); color: #fff; border: none; padding: .5rem 1rem; cursor: pointer; border-radius: 4px; }
    input[type=text] { width: 200px; }
    button:hover { opacity: .85; }
  </style>
</head>
<body>
  <header>
    <div class="title" id="appTitle">FlashDeck: <span id="editionName">IMC Unit 1 Edition</span></div>
    <div class="actions">
      <button id="homeBtn">Home</button>
      <button id="randomBtn">Random</button>
      <button id="printSelectedBtn">Print Selected</button>
      <button id="printAllBtn">Print All</button>
      <button id="deleteSelectedBtn">Delete Selected</button>
      <button id="deleteAllBtn">Delete All</button>
      <div class="dropdown">
        <button class="profile-btn" id="profileBtn">Profile ▾</button>
        <div class="dropdown-menu" id="profileMenu">
          <button id="addBtn">Add More</button>
          <button id="editTitleBtn">Edit Title</button>
          <button id="signOutBtn">Sign Out</button>
        </div>
      </div>
    </div>
  </header>

  <section id="uploadSection" style="display:none;">
    <label for="fileInput">Bulk upload CSV (Front,Back):</label>
    <input type="file" id="fileInput" accept=".csv" />
    <div style="margin-top:1rem;">
      <input type="text" id="manualFront" placeholder="Manual Front text" />
      <input type="text" id="manualBack" placeholder="Manual Back text" />
      <button id="addManualBtn">Add Card</button>
      <button id="cancelBtn">Cancel</button>
    </div>
  </section>

  <section id="homeView" style="display:none;">
    <h2>Select a Card</h2>
    <div class="card-grid" id="gridContainer"></div>
  </section>

  <section id="cardView" style="display:none;">
    <div id="cardBox"><div id="cardText"></div></div>
    <div class="nav-btns">
      <button id="prevBtn">Previous</button>
      <button id="nextBtn">Next</button>
      <button id="flipBtn">Flip</button>
    </div>
  </section>

  <script>
    const profileBtn = document.getElementById('profileBtn');
    const profileMenu = document.getElementById('profileMenu');
    profileBtn.addEventListener('click', e => { e.stopPropagation(); profileMenu.style.display = profileMenu.style.display === 'block' ? 'none' : 'block'; });
    document.addEventListener('click', () => profileMenu.style.display = 'none');

    let cards = [];
    const fileInput = document.getElementById('fileInput');
    const uploadSection = document.getElementById('uploadSection');
    const homeView = document.getElementById('homeView');
    const cardView = document.getElementById('cardView');
    const grid = document.getElementById('gridContainer');
    const cardText = document.getElementById('cardText');
    let current = 0, showingFront = true;

    function showHome() { uploadSection.style.display = 'none'; homeView.style.display = 'block'; cardView.style.display = 'none'; }
    function buildGrid() {
      grid.innerHTML = '';
      cards.forEach((c,i) => {
        const w = document.createElement('div'); w.style.position='relative';
        const cb = document.createElement('input'); cb.type='checkbox'; cb.className='select-checkbox'; cb.style.position='absolute'; cb.style.top='8px'; cb.style.right='8px'; cb.dataset.index=i;
        w.append(cb);
        const btn = document.createElement('button'); btn.className='card-button'; btn.textContent = c.Front.length>50 ? c.Front.slice(0,50)+'…':c.Front;
        btn.onclick = () => openCard(i);
        w.append(btn);
        grid.append(w);
      });
    }
    function openCard(i) { current=i; showingFront=true; cardText.textContent=cards[i].Front; cardView.style.display='block'; homeView.style.display='none'; }
    function loadSaved(){ const s=localStorage.getItem('flashcards'); if(s) cards=JSON.parse(s); }

    loadSaved(); showHome(); buildGrid();

    document.getElementById('addBtn').onclick = () => { uploadSection.style.display='block'; homeView.style.display='none'; };
    document.getElementById('cancelBtn').onclick = showHome;
    document.getElementById('addManualBtn').onclick = () => {
      const f=document.getElementById('manualFront').value.trim(); const b=document.getElementById('manualBack').value.trim();
      if(f&&b){ cards.push({Front:f,Back:b}); localStorage.setItem('flashcards',JSON.stringify(cards)); document.getElementById('manualFront').value=''; document.getElementById('manualBack').value=''; showHome(); buildGrid(); }
    };

    fileInput.addEventListener('change',e=>{
      const r=new FileReader(); r.onload=ev=>{ ev.target.result.trim().split(/\r?\n/).slice(1).forEach(l=>{ const p=l.match(/(".*?"|[^,]+),(?:"(.*?)"|(.+))/); if(p){ const f=(p[1]||'').replace(/^"|"$/g,''); const b=(p[2]||p[3]||'').replace(/^"|"$/g,''); cards.push({Front:f,Back:b}); } }); localStorage.setItem('flashcards',JSON.stringify(cards)); fileInput.value=''; showHome(); buildGrid(); };
      r.readAsText(e.target.files[0]);
    });

    document.getElementById('randomBtn').onclick = () => { if(cards.length) openCard(Math.floor(Math.random()*cards.length)); };
    document.getElementById('flipBtn').onclick = () => { showingFront=!showingFront; cardText.textContent = showingFront?cards[current].Front:cards[current].Back; };
    document.getElementById('cardBox').onclick = () => document.getElementById('flipBtn').click();
    document.getElementById('prevBtn').onclick = () => openCard((current-1+cards.length)%cards.length);
    document.getElementById('nextBtn').onclick = () => openCard((current+1)%cards.length);

    document.getElementById('printAllBtn').onclick = () => {
      const w=window.open('','_blank'); w.document.write('<html><head><title>All Flash-cards</title><style>body{font-family:Arial,sans-serif}.card{border:1px solid#000;margin:10px;padding:10px}</style></head><body>');
      cards.forEach((c,i)=>w.document.write(`<div class="card"><h3>${i+1}. ${c.Front}</h3><p>${c.Back}</p></div>`));
      w.document.write('</body></html>'); w.document.close(); w.print();
    };

    document.getElementById('printSelectedBtn').onclick = () => {
      const sel=Array.from(document.getElementsByClassName('select-checkbox')).filter(cb=>cb.checked).map(cb=>cards[cb.dataset.index]); if(!sel.length) return alert('No cards selected');
      const w=window.open('','_blank'); w.document.write('<html><head><title>Selected Flash-cards</title><style>body{font-family:Arial,sans-serif}.card{border:1px solid#000;margin:10px;padding:10px}</style></head><body>');
      sel.forEach((c,i)=>w.document.write(`<div class="card"><h3>${i+1}. ${c.Front}</h3><p>${c.Back}</p></div>`));
      w.document.write('</body></html>'); w.document.close(); w.print();
    };

    document.getElementById('deleteSelectedBtn').onclick = () => {
      if(!confirm('Delete selected cards?')) return;
      const remain = cards.filter((_,i)=> !document.querySelector(`.select-checkbox[data-index="${i}"]`).checked);
      cards = remain; localStorage.setItem('flashcards',JSON.stringify(cards)); buildGrid();
    };

    document.getElementById('deleteAllBtn').onclick = () => {
      if(!confirm('Delete ALL cards?')) return;
      cards = []; localStorage.removeItem('flashcards'); buildGrid(); showHome();
    };

    document.getElementById('editTitleBtn').onclick = () => {
      const t = prompt('New edition title:', document.getElementById('editionName').textContent);
      if(t) document.getElementById('editionName').textContent = t;
    };

    document.getElementById('signOutBtn').onclick = () => { /* your sign out logic */ location.reload(); };
  </script>
</body>
</html>
